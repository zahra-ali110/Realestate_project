{% load static %}
<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>My Profile - Real Estate</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">
</head>

<body class="bg-gray-50 font-sans">
  <!-- Navbar -->
  <nav class="bg-white/95 backdrop-blur-md shadow-lg fixed w-full top-0 z-50 transition-all duration-300">
    <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
      <div class="flex justify-between items-center h-16">
        <a href="{% url 'index' %}"
          class="text-2xl font-bold bg-gradient-to-r from-teal-600 to-cyan-600 bg-clip-text text-transparent">
          PropertyHub
        </a>

        <div class="hidden md:flex items-center justify-center flex-1">
          <div class="flex items-baseline space-x-8">
            <a href="{% url 'index' %}" class="text-gray-900 hover:text-teal-600 px-3 py-2 text-sm font-medium">Home</a>
            <a href="{% url 'properties' %}"
              class="text-gray-600 hover:text-teal-600 px-3 py-2 text-sm font-medium">Properties</a>
            <a href="{% url 'post_property' %}"
              class="text-gray-600 hover:text-teal-600 px-3 py-2 text-sm font-medium">Post Property</a>
            <a href="#" class="text-gray-600 hover:text-teal-600 px-3 py-2 text-sm font-medium">About</a>
            <a href="#" class="text-gray-600 hover:text-teal-600 px-3 py-2 text-sm font-medium">Contact</a>
          </div>
        </div>

        <div class="hidden md:flex items-center space-x-4">
          {% if user.is_authenticated %}
          <a href="{% url 'profile' %}" class="mr-4 text-gray-700 hover:text-teal-600 font-semibold">
            Hello, {{ user.username }}
          </a>
          <a href="{% url 'account_logout' %}" class="bg-red-500 text-white px-4 py-2 rounded-full">
            Logout
          </a>
          {% else %}
          <a href="{% url 'account_login' %}"
            class="text-gray-600 hover:text-teal-600 px-3 py-2 text-sm font-medium">Login</a>
          <a href="{% url 'account_signup' %}"
            class="bg-gradient-to-r from-teal-600 to-cyan-600 text-white px-6 py-2 rounded-full">Sign Up</a>
          {% endif %}
        </div>
      </div>
    </div>
  </nav>

  <!-- Profile Section -->
  <section class="relative pt-28 pb-16 text-white">
    <!-- Background image with teal overlay -->
    <div class="absolute inset-0">
      <img src="{% static 'images/img3.jpg' %}" alt="Background" class="w-full h-full object-cover">
      <div class="absolute inset-0 bg-teal-500 opacity-10"></div>
    </div>

    <!-- Content -->
    <div class="relative container mx-auto px-4">
      <div class="flex flex-col md:flex-row items-center md:items-start">

        <!-- Avatar -->
        <div class="w-32 h-32 rounded-full overflow-hidden border-4 border-white shadow-lg mb-6 md:mb-0 md:mr-8">
          <img src="{% static 'images/default-avatar.png' %}" alt="Profile" class="w-full h-full object-cover">
        </div>

        <!-- User Info -->
        <div class="flex-1">
          <!-- Top row: Username + Notifications -->
          <div class="flex items-center space-x-4">
            <!-- Username with inline edit -->
            <div class="flex items-center space-x-2">
              <h1 id="username-display" class="text-3xl md:text-4xl font-bold mb-2">{{ user.username }}</h1>
              <button id="edit-username-btn" class="text-teal-300 hover:text-white">
                <i class="fas fa-edit"></i>
              </button>
            </div>

            <!-- Notifications Bell -->
            <div class="relative ml-auto">
              <button id="notification-btn" class="relative text-white hover:text-teal-300 focus:outline-none">
                <i class="fas fa-bell text-2xl"></i>
                {% if messages %}
                <span
                  class="absolute top-0 right-0 inline-block w-2 h-2 bg-red-500 rounded-full ring-2 ring-white"></span>
                {% endif %}
              </button>
              <!-- Dropdown -->
              <div id="notification-dropdown"
                class="hidden absolute right-0 mt-2 w-72 bg-white rounded-lg shadow-lg overflow-hidden z-50">
                <div class="p-4 border-b text-gray-800 font-semibold">Notifications</div>
                <ul class="max-h-60 overflow-y-auto">
                  {% if messages %}
                  {% for message in messages %}
                  <li class="px-4 py-2 border-b hover:bg-gray-100 text-gray-700 text-sm">{{ message }}</li>
                  {% endfor %}
                  {% else %}
                  <li class="px-4 py-2 text-gray-500 text-sm">No notifications</li>
                  {% endif %}
                </ul>
              </div>
            </div>
          </div>

          <!-- Inline edit form (hidden by default) -->
          <form id="edit-username-form" action="{% url 'edit_username' %}" method="POST"
            class="flex items-center space-x-2 mt-2 hidden">
            {% csrf_token %}
            <input type="text" name="username" value="{{ user.username }}"
              class="p-2 rounded border border-gray-300 focus:ring-2 focus:ring-teal-500 focus:outline-none">
            <button type="submit"
              class="bg-teal-600 hover:bg-teal-700 text-white px-4 py-2 rounded font-semibold">Save</button>
            <button type="button" id="cancel-username-btn" class="text-gray-200 hover:text-white">Cancel</button>
          </form>

          <p class="text-teal-100 mb-4 font-semibold">Real Estate Professional</p>

          <!-- Contact info -->
          <div
            class="flex flex-col sm:flex-row items-center justify-center md:justify-start space-y-2 sm:space-y-0 sm:space-x-6 text-sm">
            <span class="flex items-center font-semibold"><i class="fas fa-envelope mr-2"></i> {{ user.email }}</span>
           
          </div>
        </div>
      </div>
    </div>
  </section>

  <!-- Stats -->
  <section class="py-10 bg-white shadow-inner">
    <div class="container mx-auto px-4 grid grid-cols-2 md:grid-cols-4 gap-6 text-center">
      <div class="p-6 bg-gray-50 rounded-xl shadow">
        <div class="text-2xl md:text-3xl font-bold text-teal-600 mb-1">{{ listed_count }}</div>
        <div class="text-sm text-gray-600">Listed Properties</div>
      </div>
      <div class="p-6 bg-gray-50 rounded-xl shadow">
        <div class="text-2xl md:text-3xl font-bold text-gray-800 mb-1">0</div>
        <div class="text-sm text-gray-600">Sold Properties</div>
      </div>
      <div class="p-6 bg-gray-50 rounded-xl shadow">
        <div class="text-2xl md:text-3xl font-bold text-gray-800 mb-1">0</div>
        <div class="text-sm text-gray-600">Favorites</div>
      </div>
      <div class="p-6 bg-gray-50 rounded-xl shadow">
        <div class="text-2xl md:text-3xl font-bold text-amber-600 mb-1">{{ rating }}</div>
        <div class="text-sm text-gray-600">Rating</div>
      </div>
    </div>
  </section>

  <!-- Properties Tabs -->
  <section class="py-12">
    <div class="container mx-auto px-4">
      <div class="mb-8 flex justify-center space-x-4">
        <button class="tab-btn bg-teal-600 text-white px-6 py-2 rounded-full shadow">My Properties</button>
        <button class="tab-btn bg-gray-200 text-gray-700 px-6 py-2 rounded-full hover:bg-gray-300">Favorites</button>
        <button class="tab-btn bg-gray-200 text-gray-700 px-6 py-2 rounded-full hover:bg-gray-300">Sold</button>
      </div>

      <!-- My Properties -->
      <div class="tab-content">
        <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
          {% for property in properties %}
          <div class="property-card bg-white rounded-2xl shadow-lg overflow-hidden">
            <div class="relative">
              <!-- Show first uploaded image -->
              <img
                src="{% if property.images.first %}{{ property.images.first.image.url }}{% else %}{% static 'images/placeholder.png' %}{% endif %}"
                alt="{{ property.title }}" class="w-full h-48 object-cover">

              <div class="absolute top-4 left-4">
                <span class="bg-green-500 text-white px-3 py-1 rounded-full text-xs font-semibold">
                  {{ property.listing_type }}
                </span>
              </div>

              <!-- Edit/Delete if belongs to user -->
              {% if property.user == user %}
              <div class="absolute top-4 right-4 flex space-x-2">
                <!-- Edit -->
                <a href="{% url 'edit_property' property.id %}"
                  class="bg-white/90 text-gray-700 p-2 rounded-full hover:bg-white transition-colors"
                  title="Edit Property">
                  <i class="fas fa-edit text-sm"></i>
                </a>
                <!-- Delete with confirmation -->
                <a href="{% url 'delete_property' property.id %}"
                  onclick="return confirm('Are you sure you want to delete this property?');"
                  class="bg-white/90 text-red-500 p-2 rounded-full hover:bg-white transition-colors"
                  title="Delete Property">
                  <i class="fas fa-trash text-sm"></i>
                </a>
              </div>
              {% endif %}
            </div>

            <div class="p-6">
              <div class="flex justify-between items-start mb-3">
                <h3 class="text-lg font-bold text-gray-900">{{ property.title }}</h3>
                <span class="text-xl font-bold text-teal-600">${{ property.price|floatformat:0 }}</span>
              </div>
              <p class="text-gray-600 mb-4 flex items-center">
                <i class="fas fa-map-marker-alt text-teal-600 mr-2"></i>
                {{ property.city }}, {{ property.state }}
              </p>
              <div class="flex justify-between text-sm text-gray-500 mb-4">
                <span><i class="fas fa-bed mr-1"></i> {{ property.bedrooms }} Beds</span>
                <span><i class="fas fa-bath mr-1"></i> {{ property.bathrooms }} Baths</span>
                <span><i class="fas fa-ruler-combined mr-1"></i> {{ property.area }} sq ft</span>
              </div>
              <div class="flex justify-between items-center">
                <span class="text-sm text-gray-500">Listed {{ property.created_at|timesince }} ago</span>
                <a href="{% url 'property_detail' property.id %}"
                  class="text-teal-600 hover:text-teal-700 font-semibold text-sm">
                  View Details <i class="fas fa-arrow-right ml-1"></i>
                </a>
              </div>
            </div>
          </div>
          {% empty %}
          <p class="text-gray-500">You haven’t listed any properties yet.</p>
          {% endfor %}
        </div>
      </div>

      <!-- Favorites & Sold -->
      <div class="tab-content hidden">
        <p class="text-gray-500">Favorites section coming soon...</p>
      </div>
      <div class="tab-content hidden">
        <p class="text-gray-500">Sold properties section coming soon...</p>
      </div>
    </div>
  </section>

  <!-- Footer -->
  <footer class="bg-gray-800 text-gray-300 py-6 text-center">
    <p>&copy; 2025 RealEstate. All rights reserved.</p>
  </footer>

  <!-- Scripts -->
  <script>
    // Tabs
    const tabBtns = document.querySelectorAll(".tab-btn");
    const tabContents = document.querySelectorAll(".tab-content");

    tabBtns.forEach((btn, i) => {
      btn.addEventListener("click", () => {
        tabBtns.forEach(b => b.classList.remove("bg-teal-600", "text-white"));
        tabBtns.forEach(b => b.classList.add("bg-gray-200", "text-gray-700"));
        btn.classList.add("bg-teal-600", "text-white");
        btn.classList.remove("bg-gray-200", "text-gray-700");

        tabContents.forEach(c => c.classList.add("hidden"));
        tabContents[i].classList.remove("hidden");
      });
    });

    // Username inline edit
    const editBtn = document.getElementById('edit-username-btn');
    const form = document.getElementById('edit-username-form');
    const display = document.getElementById('username-display');
    const cancelBtn = document.getElementById('cancel-username-btn');

    editBtn.addEventListener('click', () => {
      form.classList.remove('hidden');
      display.classList.add('hidden');
      editBtn.classList.add('hidden');
    });

    cancelBtn.addEventListener('click', () => {
      form.classList.add('hidden');
      display.classList.remove('hidden');
      editBtn.classList.remove('hidden');
    });

    // Notifications dropdown
    const notifBtn = document.getElementById('notification-btn');
    const notifDropdown = document.getElementById('notification-dropdown');

    notifBtn.addEventListener('click', (e) => {
      e.stopPropagation();
      notifDropdown.classList.toggle('hidden');
    });

    document.addEventListener('click', () => {
      notifDropdown.classList.add('hidden');
    });
  </script>

</body>

</html>
